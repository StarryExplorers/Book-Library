<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spark's Book Library</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family: sans-serif; margin:0; padding:0; background:#f0f0f0; color:#333; transition: background 0.3s, color 0.3s; }
header { background:#6200ea; color:white; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
header h1 { margin:0; font-size:1.5em; }
.tabs { display:flex; gap:10px; padding:10px 20px; background:#eee; }
.tab { cursor:pointer; padding:5px 10px; border-radius:5px; background:#ddd; }
.tab.active { background:#6200ea; color:white; }
.section { display:none; padding:20px; }
.section.active { display:block; }
.book-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:15px; }
.book-card { background:white; padding:10px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); cursor:pointer; display:flex; flex-direction:column; align-items:center; }
.book-card img { width:100px; height:150px; object-fit:cover; margin-bottom:10px; }
.book-card h3 { font-size:1em; margin:0; text-align:center; }
.book-card p { font-size:0.8em; margin:2px 0; text-align:center; }
.book-card button { margin-top:5px; padding:2px 5px; font-size:0.8em; cursor:pointer; }
.upload-section { background:white; padding:20px; border-radius:5px; box-shadow:0 2px 5px rgba(0,0,0,0.2); max-width:500px; margin:auto; }
.upload-section input, .upload-section select { width:100%; margin-bottom:10px; padding:5px; }
#pdfViewer { width:100%; height:600px; border:none; }
.dark { background:#121212; color:#f0f0f0; }
.dark header { background:#3700b3; }
.dark .tab.active { background:#bb86fc; color:#121212; }
</style>
</head>
<body>

<header>
  <h1>Spark's Book Library</h1>
  <button id="toggleTheme">Light/Dark</button>
</header>

<div class="tabs">
  <div class="tab active" data-tab="home">Home</div>
  <div class="tab" data-tab="favourites">Favourites</div>
  <div class="tab" data-tab="popular">Popular</div>
  <div class="tab" data-tab="upload">Upload</div>
</div>

<div id="home" class="section active">
  <input type="text" id="searchHome" placeholder="Search by title, author, or category">
  <div class="book-grid" id="bookGrid"></div>
</div>

<div id="favourites" class="section">
  <div class="book-grid" id="favGrid"></div>
</div>

<div id="popular" class="section">
  <div class="book-grid" id="popGrid"></div>
</div>

<div id="upload" class="section">
  <input type="password" id="uploadPassword" placeholder="Enter developer password">
  <small>This section is for the developer üòÅ</small>
  <div id="uploadFormContainer" style="display:none;">
    <div class="upload-section">
      <input type="text" id="bookTitle" placeholder="Book Title">
      <input type="text" id="bookAuthor" placeholder="Author">
      <input type="text" id="bookCategory" placeholder="Category">
      <input type="file" id="bookPDF" accept="application/pdf">
      <input type="file" id="bookCover" accept="image/*">
      <input type="date" id="bookPubDate">
      <input type="text" id="bookPublisher" placeholder="Publisher">
      <button id="addBookBtn">Add Book</button>
    </div>
  </div>
</div>

<!-- PDF Viewer Modal -->
<div id="pdfModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); justify-content:center; align-items:center;">
  <iframe id="pdfViewer"></iframe>
  <button style="position:absolute; top:10px; right:10px; padding:5px 10px; cursor:pointer;" onclick="closePDF()">Close</button>
</div>

<script>
// Developer password
const DEV_PASSWORD = "spark123";

// LocalStorage
let books = JSON.parse(localStorage.getItem('books')||"[]");
let favourites = JSON.parse(localStorage.getItem('favourites')||"[]");

// Theme
document.getElementById('toggleTheme').onclick = ()=>document.body.classList.toggle('dark');

// Tabs
const tabs = document.querySelectorAll('.tab');
tabs.forEach(tab => {
  tab.onclick = () => {
    document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.getElementById(tab.dataset.tab).classList.add('active');
    tab.classList.add('active');
    renderAll();
  }
});

// Upload password
document.getElementById('uploadPassword').addEventListener('input', e=>{
  document.getElementById('uploadFormContainer').style.display = e.target.value===DEV_PASSWORD?'block':'none';
});

// Add book
document.getElementById('addBookBtn').onclick = ()=>{
  const title=document.getElementById('bookTitle').value.trim();
  const author=document.getElementById('bookAuthor').value.trim();
  const category=document.getElementById('bookCategory').value.trim();
  const pdfFile=document.getElementById('bookPDF').files[0];
  const coverFile=document.getElementById('bookCover').files[0];
  const pubDate=document.getElementById('bookPubDate').value;
  const publisher=document.getElementById('bookPublisher').value;

  if(!title||!author||!category||!pdfFile){alert("Title, Author, Category, and PDF are required.");return;}

  const readerPDF = new FileReader();
  const readerCover = new FileReader();
  readerPDF.onload = e=>{
    readerCover.onload = ev=>{
      books.push({
        id:Date.now(), title, author, category,
        pdf:e.target.result,
        cover:coverFile?ev.target.result:"",
        pubDate, publisher, favCount:0, added:new Date().toISOString()
      });
      localStorage.setItem('books', JSON.stringify(books));
      alert("Book added!");
      renderAll();
    };
    if(coverFile) readerCover.readAsDataURL(coverFile);
    else readerCover.onload({target:{result:""}});
  };
  readerPDF.readAsDataURL(pdfFile);

  // clear form
  document.getElementById('bookTitle').value="";
  document.getElementById('bookAuthor').value="";
  document.getElementById('bookCategory').value="";
  document.getElementById('bookPDF').value="";
  document.getElementById('bookCover').value="";
  document.getElementById('bookPubDate').value="";
  document.getElementById('bookPublisher').value="";
};

// Book card creation
function createBookCard(b){
  const card=document.createElement('div'); card.className='book-card';
  const img=document.createElement('img'); img.src=b.cover||'https://via.placeholder.com/100x150.png?text=No+Cover';
  const title=document.createElement('h3'); title.textContent=b.title;
  const author=document.createElement('p'); author.textContent=b.author;
  const cat=document.createElement('p'); cat.textContent=b.category;
  const favBtn=document.createElement('button'); favBtn.textContent=favourites.includes(b.id)?'‚òÖ':'‚òÜ';
  favBtn.onclick=e=>{
    e.stopPropagation();
    if(favourites.includes(b.id)) favourites=favourites.filter(x=>x!==b.id);
    else favourites.push(b.id);
    localStorage.setItem('favourites', JSON.stringify(favourites));
    renderAll();
  };
  card.onclick=()=>openPDF(b.pdf);
  card.append(img,title,author,cat,favBtn);
  return card;
}

// Render all sections
function renderAll(){
  const search=document.getElementById('searchHome')?.value.toLowerCase()||"";
  // Home
  const bookGrid=document.getElementById('bookGrid'); bookGrid.innerHTML="";
  books.filter(b=>b.title.toLowerCase().includes(search)||b.author.toLowerCase().includes(search)||b.category.toLowerCase().includes(search))
       .forEach(b=>bookGrid.appendChild(createBookCard(b)));
  // Favourites
  const favGrid=document.getElementById('favGrid'); favGrid.innerHTML="";
  favourites.forEach(id=>{
    const b=books.find(bb=>bb.id===id); if(b) favGrid.appendChild(createBookCard(b));
  });
  // Popular
  const popGrid=document.getElementById('popGrid'); popGrid.innerHTML="";
  books.sort((a,b)=>b.favCount - a.favCount).forEach(b=>popGrid.appendChild(createBookCard(b)));
}

// PDF Viewer
function openPDF(url){document.getElementById('pdfViewer').src=url; document.getElementById('pdfModal').style.display='flex';}
function closePDF(){document.getElementById('pdfModal').style.display='none'; document.getElementById('pdfViewer').src='';}

// Search
document.getElementById('searchHome').addEventListener('input', renderAll);

// Update favCount for popular books
setInterval(()=>{
  books.forEach(b=>b.favCount=favourites.filter(id=>id===b.id).length);
  localStorage.setItem('books', JSON.stringify(books));
  renderAll();
},3000);

// Initial render
renderAll();

// Service worker registration
if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js').then(()=>console.log('SW registered')).catch(console.error);}
</script>
</body>
</html>
